<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Imgfloat Admin</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<div class="admin-layout">
    <header>
        <h2>Channel <span th:text="${broadcaster}"></span> overlay controls</h2>
        <div class="actions">
            <form th:action="@{/logout}" method="post">
                <button class="secondary" type="submit">Logout</button>
            </form>
        </div>
    </header>
    <section class="controls">
        <div>
            <h3>Overlay assets</h3>
            <p>Upload images to place on the broadcaster's overlay. Changes are visible to the broadcaster instantly.</p>
            <input id="asset-file" type="file" accept="image/*" />
            <button onclick="uploadAsset()">Upload</button>
            <ul id="asset-list" class="asset-list"></ul>
            <div id="asset-controls" class="panel hidden">
                <div class="panel-header">
                    <h4 id="selected-asset-name">Selected asset</h4>
                    <small id="selected-asset-meta"></small>
                </div>
                <div class="control-grid">
                    <label>
                        Width
                        <input id="asset-width" type="number" min="10" step="5" />
                    </label>
                    <label>
                        Height
                        <input id="asset-height" type="number" min="10" step="5" />
                    </label>
                    <label class="checkbox-inline">
                        <input id="maintain-aspect" type="checkbox" checked />
                        Maintain aspect ratio
                    </label>
                </div>
                <div class="control-actions">
                    <button type="button" onclick="nudgeRotation(-5)" class="secondary">Rotate left</button>
                    <button type="button" onclick="nudgeRotation(5)" class="secondary">Rotate right</button>
                    <button type="button" onclick="applyTransformFromInputs()">Apply size</button>
                    <button type="button" onclick="recenterSelectedAsset()" class="secondary">Re-center asset</button>
                </div>
            </div>
        </div>
    </section>
    <section class="overlay" id="admin-overlay">
        <iframe th:src="${'https://player.twitch.tv/?channel=' + broadcaster + '&parent=localhost'}" allowfullscreen></iframe>
        <canvas id="admin-canvas"></canvas>
    </section>
</div>
<script th:inline="javascript">
    const broadcaster = /*[[${broadcaster}]]*/ '';
    const username = /*[[${username}]]*/ '';
</script>
<script src="/js/admin.js"></script>
</body>
</html>
