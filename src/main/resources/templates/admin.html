<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Imgfloat Admin</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<div class="admin-layout">
    <header>
        <h2>Channel <span th:text="${broadcaster}"></span> overlay controls</h2>
        <div class="actions">
            <form th:action="@{/logout}" method="post">
                <button class="secondary" type="submit">Logout</button>
            </form>
        </div>
    </header>
    <section class="controls">
        <div>
            <h3>Overlay assets</h3>
            <p>Upload images to place on the broadcaster's overlay. Changes are visible to the broadcaster instantly.</p>
            <input id="asset-file" type="file" accept="image/*,video/*" />
            <button onclick="uploadAsset()">Upload</button>
            <ul id="asset-list" class="asset-list"></ul>
            <div id="asset-controls" class="panel hidden asset-settings">
                <div class="panel-header">
                    <div class="selected-asset-banner">
                        <div class="selected-asset-main">
                            <p class="eyebrow subtle">Asset settings</p>
                            <div class="title-row">
                                <h4 id="selected-asset-name">Selected asset</h4>
                                <span class="badge subtle" id="selected-asset-visibility">Visible</span>
                            </div>
                            <p class="muted meta-text" id="selected-asset-meta"></p>
                        </div>
                        <div class="selected-asset-actions">
                            <button type="button" id="selected-asset-toggle" class="ghost icon-button" title="Toggle visibility">
                                <span class="icon" aria-hidden="true">üôà</span>
                                <span class="label">Hide</span>
                            </button>
                            <button type="button" id="selected-asset-delete" class="ghost danger icon-button" title="Delete asset">
                                <span class="icon" aria-hidden="true">üóëÔ∏è</span>
                                <span class="label">Delete</span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-summary">
                        <p class="muted">Fine-tune the selected overlay item with sizing, playback, and layering controls.</p>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="section-header">
                        <h5>Size & placement</h5>
                        <p class="muted">Keep your overlay crisp by locking aspect ratio while resizing.</p>
                    </div>
                    <div class="control-grid condensed">
                        <label>
                            Width
                            <input id="asset-width" class="number-input" type="number" min="10" step="5" />
                        </label>
                        <label>
                            Height
                            <input id="asset-height" class="number-input" type="number" min="10" step="5" />
                        </label>
                        <label class="checkbox-inline">
                            <input id="maintain-aspect" type="checkbox" checked />
                            Maintain aspect ratio
                        </label>
                    </div>
                </div>

                <div class="panel-section two-col">
                    <div>
                        <div class="section-header">
                            <h5>Playback</h5>
                            <p class="muted">Tweak animation speed or mute video assets.</p>
                        </div>
                        <div class="control-grid condensed">
                            <label>
                                Animation speed (% of original)
                                <input id="asset-speed" class="number-input" type="number" min="10" max="400" step="5" value="100" />
                            </label>
                            <label class="checkbox-inline">
                                <input id="asset-muted" type="checkbox" />
                                Mute
                            </label>
                        </div>
                    </div>
                    <div>
                        <div class="section-header">
                            <h5>Layering</h5>
                            <p class="muted">Reorder assets to fit your scene.</p>
                        </div>
                        <div class="control-grid condensed">
                            <label>
                                Layer (Z)
                                <div class="badge-row stacked">
                                    <span class="badge">Layer <strong id="asset-z-level">0</strong></span>
                                    <span class="badge subtle" id="asset-type-label"></span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="control-actions filled">
                    <button type="button" onclick="nudgeRotation(-5)" class="secondary">Rotate left</button>
                    <button type="button" onclick="nudgeRotation(5)" class="secondary">Rotate right</button>
                    <button type="button" onclick="applyTransformFromInputs()">Apply size</button>
                    <button type="button" onclick="recenterSelectedAsset()" class="secondary">Re-center asset</button>
                </div>
                <div class="control-actions filled">
                    <button type="button" onclick="sendToBack()" class="secondary">Send to back</button>
                    <button type="button" onclick="bringBackward()" class="secondary">Bring backward</button>
                    <button type="button" onclick="bringForward()" class="secondary">Bring forward</button>
                    <button type="button" onclick="bringToFront()" class="secondary">Bring to front</button>
                </div>
            </div>
        </div>
    </section>
    <section class="overlay" id="admin-overlay">
        <iframe th:src="${'https://player.twitch.tv/?channel=' + broadcaster + '&parent=localhost'}" allowfullscreen></iframe>
        <canvas id="admin-canvas"></canvas>
    </section>
</div>
<script th:inline="javascript">
    const broadcaster = /*[[${broadcaster}]]*/ '';
    const username = /*[[${username}]]*/ '';
</script>
<script src="/js/admin.js"></script>
</body>
</html>
