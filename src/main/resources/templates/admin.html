<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Imgfloat Admin</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<div class="admin-layout">
    <header>
        <h2>Channel <span th:text="${broadcaster}"></span> overlay controls</h2>
        <div class="actions">
            <form th:action="@{/logout}" method="post">
                <button class="secondary" type="submit">Logout</button>
            </form>
        </div>
    </header>
    <section class="overlay" id="admin-overlay">
        <iframe th:src="${'https://player.twitch.tv/?channel=' + broadcaster + '&parent=localhost'}" allowfullscreen></iframe>
        <canvas id="admin-canvas"></canvas>
    </section>
    <section class="controls assets-panel">
        <div>
            <h3>Overlay assets</h3>
            <p>Upload overlay visuals and adjust them inline.</p>
            <input id="asset-file" type="file" accept="image/*,video/*" />
            <button onclick="uploadAsset()">Upload</button>
            <ul id="asset-list" class="asset-list"></ul>
            <div id="asset-controls-placeholder" class="hidden"></div>
            <div id="asset-controls" class="panel hidden asset-settings">
                <div class="panel-header">
                    <h4 id="selected-asset-name">Asset settings</h4>
                    <div class="selected-asset-actions">
                        <button type="button" id="selected-asset-toggle" class="ghost icon-button" title="Toggle visibility">
                            <i class="fa-solid fa-eye" aria-hidden="true"></i>
                            <span class="sr-only">Toggle visibility</span>
                        </button>
                        <button type="button" id="selected-asset-delete" class="ghost danger icon-button" title="Delete asset">
                            <i class="fa-solid fa-trash" aria-hidden="true"></i>
                            <span class="sr-only">Delete asset</span>
                        </button>
                    </div>
                </div>
                <div class="badge-row stacked">
                    <span class="badge subtle" id="selected-asset-visibility">Visible</span>
                    <span class="badge subtle" id="asset-type-label"></span>
                    <span class="badge subtle" id="asset-z-badge"></span>
                    <span class="badge subtle" id="asset-aspect-label"></span>
                </div>

                <div class="panel-section">
                    <div class="section-header">
                        <h5>Layout & order</h5>
                    </div>
                    <div class="control-grid condensed three-col">
                        <label>
                            Width
                            <input id="asset-width" class="number-input" type="number" min="10" step="5" />
                        </label>
                        <label>
                            Height
                            <input id="asset-height" class="number-input" type="number" min="10" step="5" />
                        </label>
                        <label class="checkbox-inline">
                            <input id="maintain-aspect" type="checkbox" checked />
                            Maintain aspect
                        </label>
                    </div>
                    <div class="control-grid condensed">
                        <label>
                            Layer (Z)
                            <div class="badge-row stacked">
                                <span class="badge">Layer <strong id="asset-z-level">1</strong></span>
                            </div>
                        </label>
                    </div>
                    <div class="control-actions filled compact">
                        <button type="button" onclick="sendToBack()" class="secondary" title="Send to back"><i class="fa-solid fa-angles-down"></i></button>
                        <button type="button" onclick="bringBackward()" class="secondary" title="Move backward"><i class="fa-solid fa-arrow-down"></i></button>
                        <button type="button" onclick="bringForward()" class="secondary" title="Move forward"><i class="fa-solid fa-arrow-up"></i></button>
                        <button type="button" onclick="bringToFront()" class="secondary" title="Bring to front"><i class="fa-solid fa-angles-up"></i></button>
                        <button type="button" onclick="recenterSelectedAsset()" class="secondary" title="Center on canvas"><i class="fa-solid fa-bullseye"></i></button>
                    </div>
                </div>

                <div class="panel-section" id="playback-section">
                    <div class="section-header">
                        <h5>Playback</h5>
                    </div>
                    <div class="control-grid condensed">
                        <label>
                            Animation speed
                            <input id="asset-speed" class="range-input" type="range" min="0" max="1000" step="10" value="100" />
                        </label>
                        <div class="range-meta"><span>0%</span><span>1000%</span></div>
                        <label class="checkbox-inline">
                            <input id="asset-muted" type="checkbox" />
                            Mute
                        </label>
                    </div>
                </div>

                <div class="control-actions filled compact">
                    <button type="button" onclick="nudgeRotation(-5)" class="secondary" title="Rotate left"><i class="fa-solid fa-rotate-left"></i></button>
                    <button type="button" onclick="nudgeRotation(5)" class="secondary" title="Rotate right"><i class="fa-solid fa-rotate-right"></i></button>
                </div>
            </div>
        </div>
    </section>
</div>
<script th:inline="javascript">
    const broadcaster = /*[[${broadcaster}]]*/ '';
    const username = /*[[${username}]]*/ '';
</script>
<script src="/js/admin.js"></script>
</body>
</html>
