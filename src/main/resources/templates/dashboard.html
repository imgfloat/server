<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Imgfloat Dashboard</title>
        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/css/styles.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
            integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body class="dashboard-body" th:classappend="${isStaging} ? ' has-staging-banner' : ''">
        <div th:insert="~{fragments/staging :: banner}"></div>
        <div class="dashboard-shell">
            <header class="dashboard-topbar">
                <div class="brand">
                    <img class="brand-mark" alt="brand" src="/img/brand.png" />
                    <div>
                        <div class="brand-title">Imgfloat</div>
                        <div class="brand-subtitle">Twitch overlay manager</div>
                    </div>
                </div>
                <div class="user-pill">
                    <div class="user-pill-copy">
                        <span class="eyebrow subtle">Signed in as</span>
                        <span class="user-display" th:text="${username}">user</span>
                    </div>
                    <a class="ghost" th:href="${docsUrl}" target="_blank" rel="noreferrer">Docs</a>
                    <form class="user-logout" th:action="@{/logout}" method="post">
                        <button class="ghost" type="submit">Logout</button>
                    </form>
                </div>
            </header>

            <section class="large-dashboard-tiles">
                <a th:href="@{'/view/' + ${channel} + '/broadcast'}">
                    <i class="fa-solid fa-tower-broadcast"></i>
                    <span>Broadcast Overlay</span>
                </a>
                <a th:href="@{'/view/' + ${channel} + '/admin'}">
                    <i class="fa-solid fa-layer-group"></i>
                    <span>Admin Console</span>
                </a>
                <a th:href="@{'/view/' + ${channel} + '/audit'}">
                    <i class="fa-solid fa-user-shield"></i>
                    <span>Audit Log</span>
                </a>
                <a th:if="${isSystemAdmin}" href="/settings">
                    <i class="fa-solid fa-gear"></i>
                    <span>Application Settings</span>
                </a>
            </section>

            <div class="dashboard-grid">
                <section class="card">
                    <p class="eyebrow">Settings</p>
                    <h3>Overlay dimensions</h3>
                    <p class="muted">Match these with your OBS resolution.</p>
                    <div class="control-grid">
                        <label>
                            Width
                            <input id="canvas-width" type="number" min="100" step="10" />
                        </label>
                        <label>
                            Height
                            <input id="canvas-height" type="number" min="100" step="10" />
                        </label>
                    </div>

                    <h3>Integrations</h3>
                    <p class="muted">Set access policy for script assets.</p>

                    <div class="control-list">
                        <label class="control">
                            <div class="title-block">
                                <p class="eyebrow">Twitch emotes</p>
                                <span class="desc">Allow script assets to use this channel's Twitch emotes.</span>
                            </div>
                            <input id="allow-channel-emotes" type="checkbox" checked />
                        </label>
                        <label class="control">
                            <div class="title-block">
                                <p class="eyebrow">7TV emotes</p>
                                <span class="desc">Allow script assets to use this channel's 7TV emotes.</span>
                            </div>
                            <input id="allow-7tv-emotes" type="checkbox" checked />
                        </label>
                        <label class="control">
                            <div class="title-block">
                                <p class="eyebrow">Chat access</p>
                                <span class="desc">Allow script assets to access this channel's Twitch chat log.</span>
                            </div>
                            <input id="allow-script-chat" type="checkbox" checked />
                        </label>
                    </div>
                    <div class="control-actions">
                        <button id="save-script-settings-btn" type="button" onclick="saveScriptSettings()">
                            Save settings
                        </button>
                        <span id="script-settings-status" class="muted" role="status" aria-live="polite"></span>
                    </div>
                </section>

                <section class="card-grid two-col dashboard-span-full">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <p class="eyebrow">Collaboration</p>
                                <h3>Channel admins</h3>
                                <p class="muted">Invite moderators to help manage assets.</p>
                            </div>
                        </div>
                        <div class="inline-form">
                            <div class="field-stack">
                                <input id="new-admin" placeholder="Twitch username" autocomplete="off" />
                                <span class="form-helper">Enter the username without the @ symbol.</span>
                            </div>
                            <button id="add-admin-btn" type="button" onclick="addAdmin()">Add admin</button>
                        </div>
                        <div class="card-section">
                            <div class="section-header">
                                <h4 class="list-title">Channel Admins</h4>
                                <p class="muted">Users who can currently modify your overlay.</p>
                            </div>
                            <ul id="admin-list" class="stacked-list"></ul>
                        </div>
                        <div class="card-section">
                            <div class="section-header">
                                <h4 class="list-title">Your Twitch moderators</h4>
                                <p class="muted">Add moderators who already help run your channel.</p>
                            </div>
                            <ul id="admin-suggestions" class="stacked-list"></ul>
                        </div>
                    </div>
                </section>

                <section th:if="${adminChannels != null}" class="card dashboard-span-full">
                    <div class="card-header">
                        <div>
                            <p class="eyebrow">Your access</p>
                            <h3>Channels you administer</h3>
                            <p class="muted">Jump into a teammate's overlay console.</p>
                        </div>
                    </div>
                    <p th:if="${#lists.isEmpty(adminChannels)}">No admin invitations yet.</p>
                    <ul th:if="${!#lists.isEmpty(adminChannels)}" class="stacked-list">
                        <li th:each="channelName : ${adminChannels}" class="stacked-list-item">
                            <div>
                                <p class="list-title" th:text="${channelName}">channel</p>
                                <p class="muted">Channel admin access</p>
                            </div>
                            <a class="button ghost" th:href="@{'/view/' + ${channelName} + '/admin'}">Open</a>
                        </li>
                    </ul>
                </section>

                <section class="card dashboard-span-full">
                    <div class="card-header">
                        <div>
                            <p class="eyebrow">Account</p>
                            <h3>Delete account</h3>
                            <p class="muted">
                                Permanently remove your account, assets, and session. This cannot be undone.
                            </p>
                        </div>
                    </div>
                    <div class="control-actions">
                        <button id="delete-account-btn" class="secondary danger" type="button">
                            Delete my account
                        </button>
                    </div>
                </section>
            </div>
        </div>
        <script src="/js/cookie-consent.js"></script>
        <script src="/js/csrf.js"></script>
        <script src="/js/toast.js"></script>
        <script src="/js/downloads.js"></script>
        <script th:inline="javascript">
            const broadcaster = /*[[${channel}]]*/ "";
        </script>
        <script src="/js/dashboard.js"></script>
    </body>
</html>
