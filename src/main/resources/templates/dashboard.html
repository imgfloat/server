<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Imgfloat Dashboard</title>
        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/css/styles.css" />
    </head>
    <body class="dashboard-body">
        <div class="dashboard-shell">
            <header class="dashboard-topbar">
                <div class="brand">
                    <img class="brand-mark" alt="brand" src="/img/brand.png" />
                    <div>
                        <div class="brand-title">Imgfloat</div>
                        <div class="brand-subtitle">Twitch overlay manager</div>
                    </div>
                </div>
                <div class="user-pill">
                    <div class="user-pill-copy">
                        <span class="eyebrow subtle">Signed in as</span>
                        <span class="user-display" th:text="${username}">user</span>
                    </div>
                    <form class="user-logout" th:action="@{/logout}" method="post">
                        <button class="ghost" type="submit">Logout</button>
                    </form>
                </div>
            </header>

            <div class="dashboard-grid">
                <section class="card">
                    <p class="eyebrow">Navigation</p>
                    <h3>Shortcuts</h3>
                    <p class="muted">Jump into your overlay</p>
                    <div class="dashboard-tile-grid">
                        <a class="dashboard-tile" th:href="@{'/view/' + ${channel} + '/broadcast'}">
                            <span class="tile-icon">Live</span>
                            <span class="tile-title">Open broadcast overlay</span>
                            <span class="tile-subtitle">Launch your live overlay view.</span>
                        </a>
                        <a class="dashboard-tile" th:href="@{'/view/' + ${channel} + '/admin'}">
                            <span class="tile-icon">Admin</span>
                            <span class="tile-title">Open admin console</span>
                            <span class="tile-subtitle">Manage assets, scripts, and layout.</span>
                        </a>
                        <a class="dashboard-tile" th:if="${isSystemAdmin}" href="/settings">
                            <span class="tile-icon">App</span>
                            <span class="tile-title">Application settings</span>
                            <span class="tile-subtitle">Configure server-wide preferences.</span>
                        </a>
                    </div>
                </section>

                <section class="card">
                    <p class="eyebrow">Settings</p>
                    <h3>Overlay dimensions</h3>
                    <p class="muted">Match these with your OBS resolution.</p>
                    <div class="control-grid">
                        <label>
                            Width
                            <input id="canvas-width" type="number" min="100" step="10" />
                        </label>
                        <label>
                            Height
                            <input id="canvas-height" type="number" min="100" step="10" />
                        </label>
                    </div>
                    <div class="control-actions">
                        <button id="save-canvas-btn" type="button" onclick="saveCanvasSettings()">Save canvas size</button>
                        <span id="canvas-status" class="muted" role="status" aria-live="polite"></span>
                    </div>
                </section>

                <section class="card">
                    <p class="eyebrow">Script privacy</p>
                    <h3>Script asset access</h3>
                    <p class="muted">Control what data scripts can access in your channel.</p>
                    <div class="dashboard-tile-grid">
                        <label class="dashboard-tile dashboard-toggle-tile">
                            <div class="tile-row">
                                <span class="tile-title">Twitch emotes</span>
                                <input id="allow-channel-emotes" type="checkbox" checked />
                            </div>
                            <span class="tile-subtitle">Allow script assets to use this channel's Twitch emotes.</span>
                        </label>
                        <label class="dashboard-tile dashboard-toggle-tile">
                            <div class="tile-row">
                                <span class="tile-title">7TV emotes</span>
                                <input id="allow-7tv-emotes" type="checkbox" checked />
                            </div>
                            <span class="tile-subtitle">Allow script assets to use this channel's 7TV emotes.</span>
                        </label>
                        <label class="dashboard-tile dashboard-toggle-tile">
                            <div class="tile-row">
                                <span class="tile-title">Chat access</span>
                                <input id="allow-script-chat" type="checkbox" checked />
                            </div>
                            <span class="tile-subtitle">Allow script assets to access this channel's Twitch chat log.</span>
                        </label>
                    </div>
                    <div class="control-actions">
                        <button id="save-script-settings-btn" type="button" onclick="saveScriptSettings()">
                            Save script settings
                        </button>
                        <span id="script-settings-status" class="muted" role="status" aria-live="polite"></span>
                    </div>
                </section>

                <section class="card-grid two-col dashboard-span-full">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <p class="eyebrow">Collaboration</p>
                                <h3>Channel admins</h3>
                                <p class="muted">Invite moderators to help manage assets.</p>
                            </div>
                        </div>
                        <div class="inline-form">
                            <div class="field-stack">
                                <input id="new-admin" placeholder="Twitch username" autocomplete="off" />
                                <span class="form-helper">Enter the username without the @ symbol.</span>
                            </div>
                            <button id="add-admin-btn" type="button" onclick="addAdmin()">Add admin</button>
                        </div>
                        <div class="card-section">
                            <div class="section-header">
                                <h4 class="list-title">Channel Admins</h4>
                                <p class="muted">Users who can currently modify your overlay.</p>
                            </div>
                            <ul id="admin-list" class="stacked-list"></ul>
                        </div>
                        <div class="card-section">
                            <div class="section-header">
                                <h4 class="list-title">Your Twitch moderators</h4>
                                <p class="muted">Add moderators who already help run your channel.</p>
                            </div>
                            <ul id="admin-suggestions" class="stacked-list"></ul>
                        </div>
                    </div>
                </section>

                <section th:if="${adminChannels != null}" class="card dashboard-span-full">
                    <div class="card-header">
                        <div>
                            <p class="eyebrow">Your access</p>
                            <h3>Channels you administer</h3>
                            <p class="muted">Jump into a teammate's overlay console.</p>
                        </div>
                    </div>
                    <p th:if="${#lists.isEmpty(adminChannels)}">No admin invitations yet.</p>
                    <ul th:if="${!#lists.isEmpty(adminChannels)}" class="stacked-list">
                        <li th:each="channelName : ${adminChannels}" class="stacked-list-item">
                            <div>
                                <p class="list-title" th:text="${channelName}">channel</p>
                                <p class="muted">Channel admin access</p>
                            </div>
                            <a class="button ghost" th:href="@{'/view/' + ${channelName} + '/admin'}">Open</a>
                        </li>
                    </ul>
                </section>
            </div>
        </div>
        <script src="/js/cookie-consent.js"></script>
        <script src="/js/csrf.js"></script>
        <script src="/js/toast.js"></script>
        <script src="/js/downloads.js"></script>
        <script th:inline="javascript">
            const broadcaster = /*[[${channel}]]*/ "";
        </script>
        <script src="/js/dashboard.js"></script>
    </body>
</html>
